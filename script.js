const isHome=!0;var diemTable,userid=localStorage.getItem("userid");function logoutClick(){localStorage.removeItem("userid"),userid="",alert("Đăng xuất thành công"),showLoginForm(),setTimeout(function(){document.getElementById("logoutBtn").disabled=!1},3e3)}function loginClick(){let e=serializeFormToJson(document.getElementById("loginForm"));console.log(e),sendPostData(e,handleLogin),setTimeout(function(){document.getElementById("loginBtn").disabled=!1},3e3)}function handleLogin(e){e.userid?(localStorage.setItem("userid",e.userid),userid=e.userid,hideLoginForm(),e.init?alert("Đăng ký thành công, hãy ghi nhớ sđt và ngày sinh bạn đã nhập để truy cập vào tài khoản"):alert("Đăng nhập thành công. Chào mừng bạn")):e.error&&alert("Bạn nhập thiếu thông tin hoặc không chính xác")}function sendPostData(e,t){fetch("https://faas-sgp1-18bc02ac.doserverless.co/api/v1/web/fn-095529cf-2322-4519-9320-10dbf07f76fb/thpt/log",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(t).catch(alert)}function serializeFormToJson(e){var t=new FormData(e),n={};for(var[o,a]of t.entries())n[o]=a;return n}function hideLoginForm(){document.getElementById("logoutForm").style.display="",document.getElementById("loginForm").style.display="none"}function showLoginForm(){document.getElementById("loginForm").style.display="",document.getElementById("logoutForm").style.display="none"}document.body.onload=(()=>{userid?hideLoginForm():showLoginForm()}),document.getElementById("loginBtn").addEventListener("click",function(e){this.disabled=!0,loginClick()}),document.getElementById("logoutBtn").addEventListener("click",function(e){this.disabled=!0,logoutClick()});const dataArr=[];var schools={};function redrawTable(){console.log("Redrawing"),$("#myTable").DataTable().clear().rows.add(dataArr).draw(),$("#myTable").DataTable().columns.adjust().draw()}function updateArr(e){dataArr.length=0,schools=e.schools,console.log(e),dataArr.push(...e.data)}function removeAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/Đ/g,"D")}let timeoutId;dataArr.push=function(){Array.prototype.push.apply(this,arguments),redrawTable()};const searchInput=document.getElementById("searchInput");function openMyTab(e,t){var n,o,a;for(o=document.getElementsByClassName("tabcontent"),n=0;n<o.length;n++)o[n].style.display="none";for(a=document.getElementsByClassName("tablinks"),n=0;n<a.length;n++)a[n].className=a[n].className.replace(" active","");document.getElementById(t).style.display="block",e.currentTarget.className+=" active"}function xetThu(e){fetch("http://127.0.0.1/nganh",{method:"POST",body:JSON.stringify({userid:userid,id:e})}).then(e=>e.json()).then(e=>{console.log(e),document.getElementById("ajaxDiv").innerHTML=e.render,showDiemTable(e.opts)}).catch(alert)}function xetThuBtnClick(e){fetch("http://127.0.0.1/chamdiem",{method:"POST",body:JSON.stringify({userid:userid,id:e})}).then(e=>e.json()).then(e=>{console.log(e);const t=document.createElement("script");t.src=e.scriptUrl,t.onload=function(){scriptOnloadCallback(e)},document.body.appendChild(t)}).catch(alert)}function showDiemTable(e){diemTable=$("#diemTable").DataTable(e)}searchInput.addEventListener("input",()=>{clearTimeout(timeoutId),timeoutId=setTimeout(()=>{searchInput.disabled=!0,fetch("http://127.0.0.1/search",{method:"POST",body:JSON.stringify({searchStr:searchInput.value})}).then(e=>e.json()).then(e=>updateArr(e.body)).then(()=>searchInput.disabled=!1)},2e3)}),searchInput.addEventListener("keydown",e=>{"Enter"===e.key&&(clearTimeout(timeoutId),searchInput.disabled=!0,fetch("http://127.0.0.1/search",{method:"POST",body:JSON.stringify({searchStr:searchInput.value})}).then(e=>e.json()).then(e=>updateArr(e.body)).then(()=>searchInput.disabled=!1))}),$(document).ready(function(){$("#myTable tfoot th").each(function(){var e=$(this).text();$(this).html('<input type="text" placeholder="Search '+e+'" />')}),$("#myTable").DataTable({lengthChange:!1,dom:"Bfrtp",pageLength:10,responsive:!0,search:{regex:!0},data:dataArr,columns:[{title:"Tên trường",data:"maTruong",render:function(e){return schools[e].tenTruong}},{title:"Ngành",data:"tenNganh",render:function(e,t,n){return e+" ("+n.maNganh+")"}},{title:"Mã trường",data:"maTruong"},{title:"Loại hình",data:"loaiHinh"},{title:"",data:"id",orderable:!1,render:function(e){return`<button type="button" class="btn btn-info" onclick = "xetThu('${e}')" data-toggle="modal" data-target="#myModal">Chi tiết</button>`}},{title:"Chuyên ngành",data:"chuyenNganh",visible:!0}],searching:!1,buttons:["colvis"],responsive:!0,language:{emptyTable:"Không có dữ liệu",zeroRecords:"Không có dữ liệu",paginate:{previous:"<",next:">"}},oLanguage:{sSearch:"Tìm kiếm"}}).on("page.dt",()=>{$("#myTable").DataTable().columns.adjust()}),fetch("http://127.0.0.1/search",{method:"GET"}).then(e=>e.json()).then(e=>updateArr(e.body))}),$("#myModal").on("hidden.bs.modal",function(){document.getElementById("ajaxDiv").innerHTML="Đang tải..."});
