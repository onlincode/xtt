var searchNganhInput=document.getElementById("searchNganhInput"),searchDaiHocInput=document.getElementById("searchDaiHocInput"),collumns=[{title:""}],table2AjaxData={nganhId:""},table4AjaxData={maTruong:""},mainDom=document.getElementById("main-content"),table2IsProcessing=!1,table4IsProcessing=!1,div1=$(mainDom).find("#div1"),div2=$(mainDom).find("#div2"),div3=$(mainDom).find("#div3"),div4=$(mainDom).find("#div4"),resData=[],table1=$("#table1").DataTable({lengthChange:!1,dom:"Brtp",pageLength:5,pagingType:"simple_numbers",responsive:{details:{display:$.fn.dataTable.Responsive.display.childRowImmediate,target:"",type:"none"}},search:{regex:!0,return:!0,search:searchNganhInput.value},ajax:{url:getApiUrl("searching",{searchType:"nganh"}),type:"GET",data:function(e){}},serverSide:!0,autoWidth:!1,sorting:!1,processing:!0,columnDefs:[{targets:"_all",orderable:!1}],columns:[{title:"Ngành",data:"tenNganh",width:"90%",render:function(e){return"<b>Ngành </b>"+e}},{title:"Mã ngành",data:"maNganh",className:"none"},{title:"Điểm chuẩn",data:"diem2024_min",render:renderDiemChuanRange,className:"none"},{data:"id",width:"10%",render:function(e){return`<button type="button" class="myButton" onclick = "showNganhDetails('${e}')">Xem</button>`}}],searching:!0,rowGroup:{dataSrc:"tenTruong"},language:{emptyTable:"Không có dữ liệu",zeroRecords:"Không có dữ liệu",paginate:{previous:"<",next:">"},searchPlaceholder:"Tìm mọi thứ",search:""},oLanguage:{sSearch:"Tìm kiếm"},scrollToTop:!0,initComplete:function(e,t){searchNganhInput.addEventListener("keyup",(function(e){var t;void 0!==e.key?t=e.key:void 0!==e.keyCode&&(t=String.fromCharCode(e.keyCode)),"Enter"!==t&&13!==e.keyCode||(e.preventDefault(),performSearch(this.value,"nganh"),this.disabled=!0)}))}}),table2=$("#table2").DataTable({paging:!1,searching:!1,info:!1,responsive:{details:{display:$.fn.dataTable.Responsive.display.childRowImmediate,target:"",type:"none"}},serverSide:!0,ajax:{url:getApiUrl("searchDetails"),type:"GET",data:function(e){e.nganhId=table2AjaxData.nganhId}},autoWidth:!1,sorting:!1,processing:!0,columnDefs:[{targets:"_all",orderable:!1,className:"none"}],columns:[{title:"Thứ tự",data:"thuTu",visible:!1},{title:"Phương thức",data:"tenPhuongThuc"},{title:"Điểm chuẩn 2024",data:"diem2024",defaultContent:"Chưa có dữ liệu"},{title:"Tổ hợp",data:"cacToHop"}],orderFixed:[0,"asc"],buttons:[{text:"Đóng",attr:{id:"closeBtn",titlle:"Đóng",class:"myButton"},action:toggleDivs}],dom:"tB",layout:{bottomEnd:"buttons"}}),table3=$("#table3").DataTable({searching:!0,pageLength:5,info:!1,responsive:{details:{display:$.fn.dataTable.Responsive.display.childRowImmediate,target:"",type:"none"}},search:{regex:!0,return:!0,search:searchDaiHocInput.value},ajax:{url:getApiUrl("searching",{searchType:"daihoc"}),type:"GET"},serverSide:!0,autoWidth:!0,sorting:!1,processing:!0,columnDefs:[{targets:"_all",orderable:!1}],columns:[{title:"Mã trường",data:"maTruong",width:"10%"},{title:"Tên trường",data:"tenTruong",width:"80%"},{title:"",data:"maTruong",width:"10%",render:function(e){return`<button type="button" class="myButton" onclick = "showDaiHocDetails('${e}')">Xem</button>`}}],dom:"rtp",initComplete:function(e,t){searchDaiHocInput.addEventListener("keyup",(function(e){var t;void 0!==e.key?t=e.key:void 0!==e.keyCode&&(t=String.fromCharCode(e.keyCode)),"Enter"!==t&&13!==e.keyCode||(e.preventDefault(),performSearch(this.value,"daihoc"),this.disabled=!0)}))},language:{emptyTable:"Không có dữ liệu",zeroRecords:"Không có dữ liệu",paginate:{previous:"<",next:">"},searchPlaceholder:"Tìm mọi thứ",search:""}}),table4=$("#table4").DataTable({paging:!0,searching:!1,info:!1,responsive:{details:{display:$.fn.dataTable.Responsive.display.childRowImmediate,target:"",type:"none"}},serverSide:!0,ajax:{url:getApiUrl("searchDetails"),type:"GET",data:function(e){e.maTruong=table4AjaxData.maTruong},dataSrc:function(e){return resData=e.data,e.data}},autoWidth:!1,sorting:!0,processing:!0,columnDefs:[{targets:"_all",orderable:!1}],columns:[{title:"Phương thức",data:"tenPhuongThuc",visible:!1},{title:"Mã ngành",data:"maNganh"},{title:"Tên ngành",data:"tenNganh"},{title:"Điểm chuẩn 2024",data:"diem2024",render:renderDiemChuan},{title:"Tổ hợp",data:"cacToHop"}],orderFixed:[0,"asc"],buttons:[{text:"Đóng",attr:{id:"closeBtn",titlle:"Đóng",class:"myButton"},action:toggleDivs2},{text:"Lưu",attr:{id:"saveBtn",titlle:"Lưu",class:"myButton"},action:sendPostRequest}],rowGroup:{dataSrc:"tenPhuongThuc"},dom:"tpB",layout:{bottomEnd:"buttons"}});function renderDiemChuan(e,t,a,n){return e}function renderDiemChuanRange(e,t,a,n){let i="Từ ";return a.diem2024_min&&a.diem2024_min>0&&(i+=a.diem2024_min),a.diem2024_max&&a.diem2024_max>0&&a.diem2024_max>a.diem2024_min&&(i+=" - "+a.diem2024_max),"Từ "==i&&(i=""),a.isTop&&(i+=" (đứng TOP 1 điểm chuẩn)"),""==i?"Chưa có dữ liệu":i}function handleInputChange(e){resData.find((t=>e.id==t.diemchuanId)).diem2024=e.value}function sendPostRequest(){table4.processing(!0),fetch(getApiUrl("mission_diemchuan"),{method:"POST",credentials:"include",body:JSON.stringify(resData),headers:{"Content-Type":"application/json"}}).then((e=>alert("success"))).then((e=>table4.processing(!1))).catch(console.log)}var performSearch=$.fn.dataTable.util.throttle((function(e,t){"nganh"==t?table1.search(e).draw():"daihoc"==t&&table3.search(e).draw()}),400);function toggleDivs(e=null){let t=table1.rows().data().toArray().find((e=>e.id==table2AjaxData.nganhId));if(table2IsProcessing){let e="<p>Ngành <b>{{tenNganh}}</b></p><br><p>Mã ngành <b>{{maNganh}}</b></p><br><p>{{tenTruong}}</p><br><p>Mã trường: <b>{{maTruong}}</b></p><br>Các phương thức xét tuyển, điểm chuẩn:<br>";document.getElementById("div1Info").innerHTML=Mustache.render(e,t),div2.toggle(),div1.fadeToggle(500)}else div1.toggle(),div2.fadeToggle(500)}function toggleDivs2(){table4IsProcessing?(div4.toggle(),div3.fadeToggle(500)):(div3.toggle(),div4.fadeToggle(500))}function showNganhDetails(e){table2IsProcessing||(table2IsProcessing=!0,table2AjaxData.nganhId=e,0==e?window.location.href=apiUrl+"/auth/google":table2.ajax.reload(toggleDivs,!1))}function showDaiHocDetails(e){table4IsProcessing||(table4IsProcessing=!0,table4AjaxData.maTruong=e,0==e?window.location.href=apiUrl+"/auth/google":table4.ajax.reload(toggleDivs2,!0))}table1.on("processing.dt",(function(e,t,a){searchNganhInput.disabled=!!a})),table2.on("processing.dt",(function(e,t,a){table2IsProcessing=a})),table3.on("processing.dt",(function(e,t,a){searchDaiHocInput.disabled=!!a})),table4.on("processing.dt",(function(e,t,a){table4IsProcessing=a}));
